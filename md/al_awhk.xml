<?xml version="1.0" encoding="utf-8"?>
<mdscript name="al_wing_hotkeys" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<cue name="OnLuaLoaderReady">
	      <conditions>
	        <event_ui_triggered screen="'Lua_Loader'" control="'Ready'" />
	      </conditions>
	      <actions>
			<raise_lua_event name="'Lua_Loader.Load'" param="'extensions.al_wing_hotkeys.whk_extension_check'"/>
			<raise_lua_event name="'Lua_Loader.Load'" param="'extensions.al_wing_hotkeys.whk_event_register'"/>
	      </actions>
	    </cue>
	    <cue name="OnLuaLoaderReadyCompleted">
	      <conditions>
	        <event_cue_completed cue="OnLuaLoaderReady" />
	      </conditions>
	      <actions>
	        <reset_cue cue="OnLuaLoaderReady" />
	        <reset_cue cue="this" />
	      </actions>
	    </cue>
		<cue name="Register_Keys" instantiate="true">
			<conditions>
				<event_cue_signalled cue="md.Hotkey_API.Reloaded" />
			</conditions>
			<actions>				  
				<!--Selectors-->
				<set_value name="$category" exact="{23811, 3000}" comment="Fleet and Wing Selectors" />
				
				<set_value name="$text" exact="{23811, 2000}" comment="Clear Fleet Selection" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_fleet_clear_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectFleet,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='Clear'
				]" />			
				
				<set_value name="$text" exact="{23811, 2003}" comment="Select Flt-1" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_1stfleet_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectFleet,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='Flt-1'
				]" />

				<set_value name="$text" exact="{23811, 2004}" comment="Select Flt-2" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_2ndfleet_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectFleet,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='Flt-2'
				]" />	
				
				<set_value name="$text" exact="{23811, 1000}" comment="Clear Wing Selection" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_clear_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectWing,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='Clear'
				]" />							

				<set_value name="$text" exact="{23811, 1001}" comment="Select Alpha Wing" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_alpha_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectWing,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='A'
				]" />

				<set_value name="$text" exact="{23811, 1002}" comment="Select Beta Wing" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_beta_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectWing,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='B'
				]" />

				<set_value name="$text" exact="{23811, 1003}" comment="Select Gamma Wing" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_gamma_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectWing,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='G'
				]" />								

				<set_value name="$text" exact="{23811, 1004}" comment="Select Delta Wing" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_select_delta_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnSelectWing,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='D'
				]" />					

				<!--Base Orders-->							

				<set_value name="$category" exact="{23811, 3001}" comment="Basic Wing Orders" />
				
				<set_value name="$text" exact="{1001, 1503} + ' ' + {1001, 7832}" comment="Subordinates Remove All Orders" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_remove_sub_orders_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnRemoveOrdersWHK,
					$contexts = ['flying', 'walking', 'menus'],		
					$echo='Subordinates: All'
				]" />

				<set_value name="$text" exact="{1001, 7832}" comment="Remove All Orders" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_remove_all_orders_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnRemoveOrdersWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: All'
				]" />
				
				<set_value name="$text" exact="{1041, 251}" comment="Fly and Wait" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_move_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnMoveWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Move'
				]" />

				<set_value name="$text" exact="{1041, 451}" comment="Dock and Wait" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_dock_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnDockWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Dock'
				]" />

				<set_value name="$text" exact="{1001, 7989}" comment="Protect until further notice" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_protect_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnProtectWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Protect'
				]" />

				<set_value name="$text" exact="{1041, 381}" comment="Protect Position" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_protectposition_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnProtectWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Protect Position'
				]" />

				<set_value name="$text" exact="{1041, 431}" comment="Attack" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_attack_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnAttackWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Attack'
				]" />

				<set_value name="$text" exact="{1041, 631}" comment="Attack targets in range" />
				<signal_cue_instantly cue="md.Hotkey_API.Register_Action" param = "table[
					$id = 'hk_attackinrange_whk',
					$category = $category,
					$name = $text,
					$onPress = InteractMenu_OnAttackInRangeWHK,
					$contexts = ['flying', 'walking', 'menus'],	
					$echo='Wing: Attack in range'
				]" />
				
			</actions>
		</cue>	
		<cue name="alAWHK" namespace="this">
			<conditions>
				<check_any>
					<event_cue_signalled cue="md.Setup.GameStart" />
					<event_game_loaded />
				</check_any>
			</conditions>
			<actions>
				<debug_text text="'event.name: ' + event.name" />
				<set_value name="$debugChance" exact="100" />
			</actions>
			<cues>
				<cue name="Init">
					<conditions>
						<check_any>
							<event_cue_signalled />
							<event_game_loaded />
						</check_any>
					</conditions>
					<actions>
						<debug_text text="'$debugChance: ' + $debugChance" />

						<set_value name="player.entity.$SelectedFleet" exact="'Plr'"/>
						
						<reset_cue cue="this" />
					</actions>
				</cue>
				<cue name="OnModInstall">
					<actions>
						<debug_text text="'$debugChance: ' + $debugChance" />
						<signal_cue cue="Init" />
					</actions>
				</cue>
				<cue name="InteractMenu_AddWingOrders" instantiate="true">
					<conditions>
						<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
					</conditions>
					<actions>
						<set_value name="$ship" exact="@event.param.$selectedplayerships.{1}" />
						<set_value name="$target" exact="@event.param.$object" />
						<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
						
						<signal_cue_instantly cue="Update_Player_Commander" />
						
						<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />
						
						<do_if value="@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">
							<set_value name="$selectiontext" exact="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' "/>
						</do_if>
						<do_else>
							<set_value name="$selectiontext" exact="player.entity.$SelectedFleet + ': '" />
						</do_else>
						
						<do_if value="@$target.fleet.iscommander and @$target.owner == faction.player">
							<set_value name="$section" exact="'main'" />						
							
							<set_value name="$text" exact="{23811, 2001}" comment="Set Flt-1" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_set_1stfleet_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_assigncommander',
									$callback = InteractMenu_OnSetFleet,
									$echo='Flt-1'
								]" />					
								
							<set_value name="$text" exact="{23811, 2002}" comment="Set Flt-2" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_set_2ndfleet_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_assigncommander',
									$callback = InteractMenu_OnSetFleet,
									$echo='Flt-2'
								]" />					

						</do_if>
						
						<do_if value="not $ship">
							<set_value name="$section" exact="'main'" />						
						
							<do_if value="not $ship and $target.isclass.sector">
								<do_if value="@player.entity.$SelectedFleet != 'Plr'">
									<set_value name="$text" exact="{23811, 2000} + ': ' + player.entity.$SelectedFleet" comment="Clear Fleet Selection: Flt" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_fleet_clear_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_recycle',
											$callback = InteractMenu_OnSelectFleet,
											$echo='Clear'
										]" />							
								</do_if>
							
								<do_if value="@player.entity.$SelectedFleet != 'Flt-1' and @player.entity.$FirstFleet">
									<set_value name="$text" exact="{23811, 2003}" comment="Select Flt-1" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_1stfleet_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectFleet,
											$echo='Flt-1'
										]" />
								</do_if>

								<do_if value="@player.entity.$SelectedFleet != 'Flt-2' and @player.entity.$SecondFleet">
									<set_value name="$text" exact="{23811, 2004}" comment="Select Flt-2" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_2ndfleet_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectFleet,
											$echo='Flt-2'
										]" />
								</do_if>
								
								<do_if value="@player.entity.$SelectedWing">
									<set_value name="$text" exact="{23811, 1000} + ': ' +  player.entity.$SelectedWing" comment="Clear Wing Selection: Wng" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_clear_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_recycle',
											$callback = InteractMenu_OnSelectWing,
											$echo='Clear'
										]" />							
								</do_if>

								<do_if value="@player.entity.$SelectedWing != 'A' and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{1}">
									<set_value name="$text" exact="{23811, 1001} + ' - ' + player.entity.$SelectedFleet" comment="Select Alpha Wing - Flt" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_alpha_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectWing,
											$echo='A'
										]" />
								</do_if>
									
								<do_if value="@player.entity.$SelectedWing != 'B' and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{2}">
									<set_value name="$text" exact="{23811, 1002} + ' - ' + player.entity.$SelectedFleet" comment="Select Beta Wing - Flt" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_beta_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectWing,
											$echo='B'
										]" />
								</do_if>
									
								<do_if value="@player.entity.$SelectedWing != 'G' and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{3}">
									<set_value name="$text" exact="{23811, 1003} + ' - ' + player.entity.$SelectedFleet" comment="Select Gamma Wing - Flt" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_gamma_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectWing,
											$echo='G'
										]" />								
								</do_if>
									
								<do_if value="@player.entity.$SelectedWing != 'D' and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{4}">
									<set_value name="$text" exact="{23811, 1004} + ' - ' + player.entity.$SelectedFleet" comment="Select Delta Wing - Flt" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_select_delta_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_assigncommander',
											$callback = InteractMenu_OnSelectWing,
											$echo='D'
										]" />	
								</do_if>
							</do_if>
																
							<!--Base Orders-->							
							<do_if value="$target and @player.entity.$SelectedFleetCommander and not @player.entity.$SelectedWing">
								<set_value name="$text" exact="$selectiontext + {1001, 1503} + ' ' + {1001, 7832}" comment="Wing: Subordinates Remove All Orders" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_remove_sub_orders_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_waitforsignal',
									$callback = InteractMenu_OnRemoveOrdersWHK,
									$echo='Subordinates: All'
								]" />
							</do_if>
							
							<do_if value="$target and $validselection">
								<set_value name="$text" exact="$selectiontext + {1001, 7832}" comment="Wing: Remove All Orders" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_remove_all_orders_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_waitforsignal',
									$callback = InteractMenu_OnRemoveOrdersWHK,
									$echo='Wing: All'
								]" />
								
								<set_value name="$text" exact="$selectiontext + {1041, 251}" comment="Wing: Fly and Wait" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = InteractMenu_OnMoveWHK,
									$echo='Wing: Move'
								]" />
							</do_if>
							
							<do_if value="@$target.dockingallowed.{@player.entity.$SelectedFleetCommander} and $validselection">	
							<set_value name="$text" exact="$selectiontext + {1041, 451}" comment="Wing: Dock and Wait" />
							<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
								$id = 'order_dock_whk',
								$section = $section,
								$text = $text,
								$icon = 'order_dockandwait',
								$callback = InteractMenu_OnDockWHK,
								$echo='Wing: Dock'
							]" />
							</do_if>	
							
							<do_if value="($target.isclass.ship or $target.isclass.spacesuit) and $validselection">
								<set_value name="$text" exact="$selectiontext + {1041, 371}" comment="Wing: Protect Ship" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_protectship_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_protectship',
										$callback = InteractMenu_OnProtectWHK,
										$echo='Wing: Protect Ship'
									]" />
							</do_if>
							<do_elseif value="$target.isclass.station and $validselection">
								<set_value name="$text" exact="$selectiontext + {1041, 361}" comment="Wing: Protect Station" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_protectstation_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_protectstation',
										$callback = InteractMenu_OnProtectWHK,
										$echo='Wing: Protect Station'
									]" />
							</do_elseif>
							<do_elseif value="$target and $validselection">
								<set_value name="$text" exact="$selectiontext + {1041, 381}" comment="Wing: Protect Position" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_protectposition_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_protectposition',
										$callback = InteractMenu_OnProtectWHK,
										$echo='Wing: Protect Position'
									]" />
							</do_elseif>
							
							<do_if value="($target.isclass.destructible) and (not ($target.owner == faction.player)) and $validselection">	
								<set_value name="$text" exact="$selectiontext + {1041, 431}" comment="Wing: Attack" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_attack_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_attack',
									$callback = InteractMenu_OnAttackWHK,
									$echo='Wing: Attack'
								]" />
							</do_if>	

							<do_if value="$target and $validselection">
								<set_value name="$text" exact="$selectiontext + {1041, 631}" comment="Wing: Attack targets in range" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_attackinrange_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_attackinrange',
										$callback = InteractMenu_OnAttackInRangeWHK,
										$echo='Wing: Attack in range'
									]" />
							</do_if>
							
							<!--Urgent Orders-->
							<do_if value="player.entity.$WHK_AUO_Enabled and $target and $validselection">
								<set_value name="$text" exact="$selectiontext + {12115, 2001}" comment="Wing: Fly and Wait, Immediate" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_immediate_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Immediate'
								]" />

								<set_value name="$text" exact="$selectiontext + {12115, 2002}" comment="Wing: Fly and Wait, Immediate/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_immediatesameplane_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Immediate / Same Plane'
								]" />

								<set_value name="$text" exact="$selectiontext + {12115, 2003}" comment="Wing: Fly and Wait, Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_sameplane_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Same Plane'
								]" />
								
								<set_value name="$text" exact="$selectiontext + {12115, 2004}" comment="Wing: Fly and Wait, No Recall" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_norecall_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: No Recall'
								]" />

								<set_value name="$text" exact="$selectiontext + {12115, 2005}" comment="Wing: Fly and Wait, No Recall/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_norecallsameplane_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: No Recall / Same Plane'
								]" />							

								<set_value name="$text" exact="$selectiontext + {12115, 2006}" comment="Wing: Fly and Wait, Urgent" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_urgent_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Urgent'
								]" />															
								
								<set_value name="$text" exact="$selectiontext + {12115, 2007}" comment="Wing: Fly and Wait, Urgent/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_urgentsameplane_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Urgent / Same Plane'
								]" />										
							</do_if>
							
							<do_if value="player.entity.$WHK_AUO_Enabled and @$target.dockingallowed.{@player.entity.$SelectedFleetCommander} and $validselection">	
								<set_value name="$text" exact="$selectiontext + {12115, 2008}" comment="Wing: Dock and Wait, Urgent" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_dock_urgent_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_dockandwait',
									$callback = md.al_urgent_orders.InteractMenu_OnDockUrgent,
									$echo='Wing: Urgent'
								]" />
							</do_if>
							
							<do_if value="player.entity.$WHK_AUO_Enabled and ($target.isclass.destructible) and (not ($target.owner == faction.player))  and $validselection">	
								<set_value name="$text" exact="$selectiontext + {12115, 2000}" comment="Wing: Attack, Immediate" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_attack_immediate_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_attack',
									$callback = md.al_urgent_orders.InteractMenu_OnAttackUrgent,
									$echo='Wing: Immediate'
								]" />
							</do_if>	
							
							<!--Subsystem Targeting Orders-->
														
							<do_if value="player.entity.$WHK_STO_Enabled and ($target.isclass.ship or $target.isclass.station) and (not ($target.owner == faction.player))  and $validselection">	
								<set_value name="$disable_flag" exact="false" />
								
								<do_if value="@$target.iscapitalship">
									<find_object_component name="$subsys" object="$target" class="class.engine" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false"/>	  
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2000}" comment="Wing: Attack Engines" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_subsystem_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: engines'
										]" />
									</do_if>
								</do_if>
								
								<do_if value="@$target.iscapitalship or $target.isclass.station">
									<find_object_component name="$subsys" object="$target" class="class.shieldgenerator" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false"  tags="[tag.large, tag.extralarge]"/>	  
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2001}" comment="Wing: Attack Shields" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_shields_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: shields'
										]" />
									</do_if>

									<find_object_component name="$subsys" object="$target" class="[class.turret]" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false" tags="[tag.small, tag.medium]"/>	
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2002}" comment="Wing: Attack M Turrets" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_m_turrets_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: weps_m'
										]" />
									</do_if>
									
									<find_object_component name="$subsys" object="$target" class="[class.turret]" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false" tags="[tag.large, tag.extralarge]"/>										
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2003}" comment="Wing: Attack L Turrets" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_l_turrets_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: weps_l'
										]" />					
									</do_if>

									<find_object_component name="$subsys" object="$target" class="[class.missileturret]" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false"/>	  											
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2004}" comment="Wing: Attack Miss Turrets" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_missturr_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: missiles'
										]" />
									</do_if>

									<find_object_component name="$subsys" object="$target" class="[class.weapon]" checkoperational="true" indestructible="false" invulnerable="false" integrated="false" multiple="false" tags="[tag.weapon]">
										<match class="class.turret" negate="true"/>
									</find_object_component>
									<do_if value="$subsys">
										<set_value name="$disable_flag" exact="true" />
										<set_value name="$text" exact="$selectiontext + {92015, 2005}" comment="Wing: Attack Main Batteries" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_batteries_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: batteries'
										]" />					
									</do_if>
									
									<do_if value="$disable_flag">
										<set_value name="$text" exact="$selectiontext + {92015, 2006}" comment="Wing: Disable" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_disable_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: disable'
										]" />					
									</do_if>
								</do_if>

								<do_if value="$target.isclass.station">		
									<find_object_component name="$subsys" object="$target" class="[class.dockarea]" checkoperational="false" integrated="false" indestructible="false" invulnerable="false" multiple="false">
										<match state="componentstate.wreck" negate="true"/>
									</find_object_component>									
									<do_if value="$subsys">
										<set_value name="$text" exact="$selectiontext + {92015, 2007}" comment="Wing: Attack Station Docks" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_stationdocks_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: stationdocks'
										]" />
									</do_if>

									<find_object_component name="$subsys" object="$target" class="[class.storage]" checkoperational="false" integrated="false" indestructible="false" invulnerable="false" multiple="false">
										<match state="componentstate.wreck" negate="true"/>
									</find_object_component>															
									<do_if value="$subsys">
										<set_value name="$text" exact="$selectiontext + {92015, 2008}" comment="Wing: Attack Station Storage" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_stationstorage_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: stationstorage'
										]" />
									</do_if>

									<find_object_component name="$subsys" object="$target" class="[class.production]" checkoperational="false" integrated="false" indestructible="false" invulnerable="false" multiple="false">
										<match state="componentstate.wreck" negate="true"/>
									</find_object_component>									
									<do_if value="$subsys">
										<set_value name="$text" exact="$selectiontext + {92015, 2009}" comment="Wing: Attack Station Production" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_stationproduction_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: stationproduction'
										]" />
									</do_if>
 
									<find_object_component name="$subsys" object="$target" class="[class.defencemodule]" checkoperational="false" integrated="false" indestructible="false" invulnerable="false" multiple="false">
										<match state="componentstate.wreck" negate="true"/>
									</find_object_component>													
									<do_if value="$subsys">
										<set_value name="$text" exact="$selectiontext + {92015, 2010}" comment="Wing: Attack Station Def. Platforms" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_stationdefense_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: stationdefense'
										]" />			
									</do_if>
									
									<find_object_component name="$subsys" object="$target" class="[class.buildmodule]" checkoperational="false" integrated="false" indestructible="false" invulnerable="false" multiple="false">
										<match state="componentstate.wreck" negate="true"/>
									</find_object_component>													
									<do_if value="$subsys">
										<set_value name="$text" exact="$selectiontext + {92015, 2011}" comment="Wing: Attack Station Shipyard Platforms" />
										<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
											$id = 'order_attack_stationbuild_whk',
											$section = $section,
											$text = $text,
											$icon = 'order_attack',
											$callback = md.al_subsystem_targeting_orders.InteractMenu_OnAttackSubSys,
											$echo='Wing: stationbuild'
										]" />			
									</do_if>

								</do_if>
							</do_if>						
						
							<do_if value="player.entity.$WHK_STO_Enabled and $validselection">
								
								<set_value name="$text" exact="$selectiontext + {92015, 2012}" comment="Wing: Clear Turret Subsystem Target" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'action_clear_turret_subsys_pref_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_lasertower',
									$callback = md.al_subsystem_targeting_orders.InteractMenu_OnClearTurretPrefs,
									$echo='Wing: clearturretsubyspref'
								]" />
							</do_if>
														
						</do_if>
						
						<cancel_cue cue="this" />
					</actions>
				</cue>
				<cue name="Update_Player_Commander">	
					<!--Function to update the commander corresponding to PLR fleet selection -->
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<!--Only update if selected fleet is the player fleet-->
						<do_if value="player.entity.$SelectedFleet == 'Plr'">
						
							<do_if value="@player.occupiedship.fleet.iscommander"> 
								<!--Player flying ship with subordinates; select player ship-->
								<set_value name="player.entity.$SelectedFleetCommander" exact="player.occupiedship" />
							</do_if>
							<do_elseif value="player.ship.fleet.iscommander or @player.ship.subordinates.count"> 
								<!--Player standing on a fleet commander's ship; select that ship-->
								<set_value name="player.entity.$SelectedFleetCommander" exact="player.ship" />
							</do_elseif>
							<do_else> 
								<!--Player standing on a ship in a fleet; select that ship's commander-->
								<set_value name="player.entity.$SelectedFleetCommander" exact="player.ship.commander" />
							</do_else>
							
							<!--If selected wing is no longer valid deselect it (for example if player teleported to a new ship that doesnt have the given wing)-->
							<do_if value="(@player.entity.$SelectedWing and not @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID})">
								<set_value name="player.entity.$SelectedWing" exact="null"/>
								<set_value name="player.entity.$SelectedWingID" exact="null"/>
							</do_if>
							
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>
				<cue name="InteractMenu_OnSetFleet">
					<!--Function to set fleet commander references/shortcuts-->
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$target" exact="event.param.$object" /> <!--entity that was right clicked on-->
						<set_value name="$setfleet" exact="event.param.$echo" /> <!--id string to determine which fleet reference is set-->
						
						<!--Update first reference if requested-->
						<do_if value="$setfleet == 'Flt-1'">
							<!--If a previous reference existed clear the name tagging before updating-->
							<do_if value="@player.entity.$FirstFleet">
								<substitute_text text="$newshipname" source="player.entity.$FirstFleet.name">
									<replace string="'Flt-1 '" with="''" />
								</substitute_text>
								
								<set_object_name object="player.entity.$FirstFleet" name="$newshipname" />
							</do_if>
							
							<!--Update the reference-->
							<set_value name="player.entity.$FirstFleet" exact="$target"/>
							
							<!--Prepend the referenced ship name with fleet tag-->
							<set_object_name object="player.entity.$FirstFleet" name="'Flt-1 ' + player.entity.$FirstFleet.name"/>
						</do_if>
						<!--Update second reference if requested-->
						<do_elseif value="$setfleet == 'Flt-2'">
							<!--If a previous reference existed clear the name tagging before updating-->
							<do_if value="@player.entity.$SecondFleet">
								<substitute_text text="$newshipname" source="player.entity.$SecondFleet.name">
									<replace string="'Flt-2 '" with="''" />
								</substitute_text>
								
								<set_object_name object="player.entity.$SecondFleet" name="$newshipname"/>
							</do_if>
							
							<!--Update the reference-->
							<set_value name="player.entity.$SecondFleet" exact="$target"/>
							
							<!--Prepend the referenced ship name with fleet tag-->
							<set_object_name object="player.entity.$SecondFleet" name="'Flt-2 ' + player.entity.$SecondFleet.name"/>
						</do_elseif>
						
						<reset_cue cue="this" />
					</actions>
				</cue>
				<cue name="InteractMenu_OnSelectFleet">
					<!--Function to quick select a previously set fleet commander reference-->
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$speak" exact="false" />
						<do_if value="event.param.$id == 'hk_select_1stfleet_whk' or event.param.$id == 'hk_select_2ndfleet_whk'">
							<set_value name="$speak" exact="true" />
						</do_if>     
					
						<!--If we're selecting a different fleet than we had previously clear the wing selection to reset to base state-->
						<do_if value="player.entity.$SelectedFleet != event.param.$echo">
							<set_value name="player.entity.$SelectedWing" exact="null"/>
							<set_value name="player.entity.$SelectedWingID" exact="null"/>
						</do_if>
					
						<!--update the fleet selection id string-->
						<set_value name="player.entity.$SelectedFleet" exact="event.param.$echo"/>
						
						<!--Select the appropriate pre-set fleet reference based upon id string-->
						<do_if value="player.entity.$SelectedFleet == 'Flt-1'">
							<set_value name="player.entity.$SelectedFleetCommander" exact="player.entity.$FirstFleet"/>
							<do_if value="$speak">
								<speak actor="player.computer" page="20402" line="1" /> <!--"I(speak as 1)"-->
								<show_notification text="player.entity.$SelectedFleet + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
							</do_if>
						</do_if>
						<do_elseif value="player.entity.$SelectedFleet == 'Flt-2'">
							<set_value name="player.entity.$SelectedFleetCommander" exact="player.entity.$SecondFleet"/>
							<do_if value="$speak">
								<speak actor="player.computer" page="20402" line="2" /> <!--"II(speak as 2)"-->
								<show_notification text="player.entity.$SelectedFleet + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
							</do_if>
						</do_elseif>
						<!--If given an unknown shortcut failover to the player fleet. Implicitly captures 'clear' command as well-->
						<do_else> 
							<set_value name="player.entity.$SelectedFleet" exact="'Plr'"/>
							<signal_cue_instantly cue="Update_Player_Commander" />
							<do_if value="$speak">
								<speak actor="player.computer" page="10002" line="28" /> <!--"Connection Lost"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 28}"/> <!--"Flt: Connection Lost"-->
							</do_if>
						</do_else>
						
						<reset_cue cue="this" />
					</actions>
				</cue>				
				<cue name="InteractMenu_OnSelectWing">
					<!--Function to quick select/update wing references-->
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$speak" exact="false" />
						<do_if value="event.param.$id == 'hk_select_alpha_whk' or event.param.$id == 'hk_select_beta_whk' or event.param.$id == 'hk_select_gamma_whk' or event.param.$id == 'hk_select_delta_whk'">
							<set_value name="$speak" exact="true" />
						</do_if>
						  
						<!--Select the appropriate wing reference based upon id string-->
						<do_if value="event.param.$echo == 'A'">
							<do_if value="@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{1}">
								<set_value name="player.entity.$SelectedWing" exact="event.param.$echo"/>
								<set_value name="player.entity.$SelectedWingID" exact="1"/>
								<do_if value="$speak">
									<speak actor="player.computer" page="20401" line="1" /> <!--"Alpha"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
								</do_if>
							</do_if>
							<do_else>
								<do_if value="$speak">
									<speak actor="player.computer" page="10002" line="563" /> <!--"No life signs detected"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + event.param.$echo + ': ' + {10002, 563}"/> <!--"Flt: No life signs detected"-->
								</do_if>							
							</do_else>
						</do_if>
						<do_elseif value="event.param.$echo == 'B'">
							<do_if value="@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{2}">
								<set_value name="player.entity.$SelectedWing" exact="event.param.$echo"/>
								<set_value name="player.entity.$SelectedWingID" exact="2"/>
								<do_if value="$speak">
									<speak actor="player.computer" page="20401" line="2" /> <!--"Beta"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
								</do_if>
							</do_if>
							<do_else>
								<do_if value="$speak">
									<speak actor="player.computer" page="10002" line="563" /> <!--"No life signs detected"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + event.param.$echo + ': ' + {10002, 563}"/> <!--"Flt: No life signs detected"-->
								</do_if>							
							</do_else>
						</do_elseif>
						<do_elseif value="event.param.$echo == 'G'">
							<do_if value="@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{3}">
								<set_value name="player.entity.$SelectedWing" exact="event.param.$echo"/>
								<set_value name="player.entity.$SelectedWingID" exact="3"/>
								<do_if value="$speak">
									<speak actor="player.computer" page="20401" line="3" /> <!--"Gamma"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
								</do_if>
							</do_if>
							<do_else>
								<do_if value="$speak">
									<speak actor="player.computer" page="10002" line="563" /> <!--"No life signs detected"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + event.param.$echo + ': ' + {10002, 563}"/> <!--"Flt: No life signs detected"-->
								</do_if>							
							</do_else>
						</do_elseif>
						<do_elseif value="event.param.$echo == 'D'">
							<do_if value="@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{4}">
								<set_value name="player.entity.$SelectedWing" exact="event.param.$echo"/>
								<set_value name="player.entity.$SelectedWingID" exact="4"/>
								<do_if value="$speak">
									<speak actor="player.computer" page="20401" line="4" /> <!--"Delta"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 27}"/> <!--"Flt: Connection Established"-->
								</do_if>
							</do_if>
							<do_else>
								<do_if value="$speak">
									<speak actor="player.computer" page="10002" line="563" /> <!--"No life signs detected"-->
									<show_notification text="player.entity.$SelectedFleet + '-' + event.param.$echo + ': ' + {10002, 563}"/> <!--"Flt: No life signs detected"-->
								</do_if>							
							</do_else>
						</do_elseif>						
						<!--If given an unknown shortcut select no wing. Implicitly captures 'clear' command-->
						<do_else>
							<set_value name="player.entity.$SelectedWing" exact="null"/>
							<set_value name="player.entity.$SelectedWingID" exact="null"/>
							<do_if value="$speak">
								<speak actor="player.computer" page="10002" line="28" /> <!--"Connection Lost"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {10002, 28}"/> <!--"Flt: Connection Lost"-->
							</do_if>
						</do_else>
						
						<reset_cue cue="this" />
					</actions>
				</cue>					
				<cue name="InteractMenu_OnAttackWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$doaction" exact="true" />
						
						<do_if value="event.param.$id == 'hk_attack_whk'">
							<set_value name="$target" exact="player.target" />
							
							<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />
							
							<do_if value="(@$target.isclass.destructible) and (not (@$target.owner == faction.player)) and $validselection">
								<speak actor="player.computer" page="10002" line="132" /> <!--"Command Accepted"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 431} + ' ' + {10002, 132}"/> <!--"Flt: Attack Command Accepted"-->
							</do_if>
							<do_else>
								<speak actor="player.computer" page="10002" line="133" /> <!--"Command Rejected"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 431} + ' ' + {10002, 133}"/> <!--"Flt: Attack Command Rejected"-->
								<set_value name="$doaction" exact="false" />		
							</do_else>
						</do_if>
						<do_else>
							<set_value name="$target" exact="event.param.$object" />
						</do_else>
						
						<do_if value="$doaction">
							<do_if value="@player.entity.$SelectedWing and 
								@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
								<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
							</do_if>
							<do_else>
								<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
							</do_else>
							
							<do_for_each name="$ship" in="@$orderships">						
								<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
								<do_if value="$ship">
									<create_order name="$order" object="$ship" id="'Attack'">
										<param name="primarytarget" value="$target" />
										<param name="debugchance" value="alAWHK.$debugChance" />
									</create_order>
								</do_if>
							</do_for_each>
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>	
				<cue name="InteractMenu_OnProtectWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$doaction" exact="true" />
						<set_value name="$protectcat" exact="event.param.$echo" />
						
						<do_if value="event.param.$id == 'hk_protectposition_whk' or event.param.$id == 'hk_protect_whk'">
							<do_if value="event.param.$id == 'hk_protectposition_whk'">
								<set_value name="$destfinal" exact="[player.entity.$SelectedFleetCommander, position.[0,0,0]]" />
								<set_value name="$protectcat" exact="'Wing: Protect Position'" />
							</do_if>
							<do_elseif value="event.param.$id == 'hk_protect_whk'">
								<do_if value="$target.isclass.ship or $target.isclass.spacesuit">
									<set_value name="$target" exact="player.target" />
									<set_value name="$protectcat" exact="'Wing: Protect Ship'" />
								</do_if>
								<do_elseif value="player.target.isclass.station">
									<set_value name="$target" exact="player.target" />
									<set_value name="$protectcat" exact="'Wing: Protect Station'" />
								</do_elseif>
							</do_elseif>
							
							<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />
							
							<do_if value="(@$destfinal or @$target) and $validselection">
								<speak actor="player.computer" page="10002" line="132" /> <!--"Command Accepted"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1001, 7989} + ' ' + {10002, 132}"/> <!--"Flt: Protect Until Further Notice Command Accepted"-->
							</do_if>
							<do_else>
								<speak actor="player.computer" page="10002" line="133" /> <!--"Command Rejected"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1001, 7989} + ' ' + {10002, 133}"/> <!--"Flt: Protect Until Further Notice Command Rjected"-->
								<set_value name="$doaction" exact="false" />		
							</do_else>
						</do_if>
						<do_else>
							<set_value name="$target" exact="@event.param.$object" />
							<set_value name="$destoffset" exact="event.param.$offset" />
							<set_value name="$destoffsetcomponent" exact="event.param.$offsetcomponent" />
							<set_value name="$destfinal" exact="[$destoffsetcomponent, $destoffset]" />
						</do_else>					
						
						<do_if value="$doaction">
							<do_if value="@player.entity.$SelectedWing and 
								@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
								<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
							</do_if>
							<do_else>
								<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
							</do_else>
							
							<do_if value="$protectcat == 'Wing: Protect Ship'">
								<do_for_each name="$ship" in="@$orderships">						
									<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
									<do_if value="$ship">
										<create_order name="$order" object="$ship" id="'ProtectShip'">
											<param name="target" value="$target" />
											<param name="debugchance" value="alAWHK.$debugChance" />
										</create_order>
									</do_if>
								</do_for_each>						
							</do_if>
							
							<do_if value="$protectcat == 'Wing: Protect Station'">
								<do_for_each name="$ship" in="@$orderships">						
									<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
									<do_if value="$ship">
										<create_order name="$order" object="$ship" id="'ProtectStation'">
											<param name="station" value="$target" />
											<param name="debugchance" value="alAWHK.$debugChance" />
										</create_order>
									</do_if>
								</do_for_each>						
							</do_if>
							
							<do_if value="$protectcat == 'Wing: Protect Position'">							
								<do_for_each name="$ship" in="@$orderships">						
									<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
									<do_if value="$ship">
										<create_order name="$order" object="$ship" id="'ProtectPosition'">
											<param name="destination" value="$destfinal" />
											<param name="debugchance" value="alAWHK.$debugChance" />
										</create_order>
									</do_if>
								</do_for_each>						
							</do_if>
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>					
				<cue name="InteractMenu_OnRemoveOrdersWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$removecat" exact="event.param.$echo" />
						 
						<do_if value="event.param.$id == 'hk_remove_sub_orders_whk' or event.param.$id == 'hk_remove_all_orders_whk'">
							<speak actor="player.computer" page="10002" line="135" /> <!--"Command Accepted"-->
							<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1001, 7832} + ' ' + {10002, 132}"/> <!--"Flt: Remove All Orders Command Accepted"-->
						</do_if>
						
						<do_if value="$removecat == 'Subordinates: All'">
							<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.allsubordinates" />
						</do_if>
						<do_elseif value="@player.entity.$SelectedWing and 
							@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
							<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
						</do_elseif>
						<do_else>
							<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
						</do_else>
												
						<do_for_each name="$ship" in="$orderships">
							<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
							<do_if value="$ship">
								<raise_lua_event name="'whk_event_clearorders'" param="$ship"/>
							</do_if>
						</do_for_each>
						<reset_cue cue="this" />
					</actions>
				</cue>								
				<cue name="InteractMenu_OnMoveWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$doaction" exact="true" />
						
						<do_if value="event.param.$id == 'hk_dock_whk'">
							<set_value name="$destfinal" exact="[player.target, position.[0,0,0]]" />
							
							<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />
							
							<do_if value="@$destfinal and $validselection">
								<speak actor="player.computer" page="10002" line="132" /> <!--"Command Accepted"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 251} + ' ' + {10002, 132}"/> <!--"Flt: Fly and Wait Command Accepted"-->
							</do_if>
							<do_else>
								<speak actor="player.computer" page="10002" line="133" /> <!--"Command Rejected"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 251} + ' ' + {10002, 133}"/> <!--"Flt: Fly and Wait Command Rejected"-->								
								<set_value name="$doaction" exact="false" />		
							</do_else>
						</do_if>
						<do_else>
							<set_value name="$destobject" exact="event.param.$object" />
							<set_value name="$destoffset" exact="event.param.$offset" />
							<set_value name="$destoffsetcomponent" exact="event.param.$offsetcomponent" />
							<set_value name="$destfinal" exact="[$destoffsetcomponent, $destoffset]" />
						</do_else>
						
						<do_if value="$doaction">
							<do_if value="@player.entity.$SelectedWing and 
								@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
								<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
							</do_if>
							<do_else>
								<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
							</do_else>
													
							<do_for_each name="$ship" in="$orderships">
								<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
								<do_if value="$ship">
									<create_order name="$order" object="$ship" id="'MoveWait'">
										<param name="destination" value="$destfinal" />
										<param name="debugchance" value="alAWHK.$debugChance" />
									</create_order>
								</do_if>
							</do_for_each>						
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>				
				<cue name="InteractMenu_OnAttackInRangeWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$doaction" exact="true" />
						
						<do_if value="event.param.$id == 'hk_attackinrange_whk'">
							<set_value name="$destfinal" exact="[player.entity.$SelectedFleetCommander, position.[0,0,0]]" />
							
							<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />
							
							<do_if value="@$destfinal and $validselection">
								<speak actor="player.computer" page="10002" line="132" /> <!--"Command Accepted"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 631} + ' ' + {10002, 132}"/> <!--"Flt: Attack Targets in Range Command Accepted"-->
							</do_if>
							<do_else>
								<speak actor="player.computer" page="10002" line="133" /> <!--"Command Rejected"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 631} + ' ' + {10002, 133}"/> <!--"Flt: Attack Targets in Range Command Rejected"-->
								<set_value name="$doaction" exact="false" />		
							</do_else>
						</do_if>
						<do_else>
							<set_value name="$destoffset" exact="event.param.$offset" />
							<set_value name="$destoffsetcomponent" exact="event.param.$offsetcomponent" />
							<set_value name="$destfinal" exact="[$destoffsetcomponent, $destoffset]" />
						</do_else>					
						
						<do_if value="$doaction">
							<do_if value="@player.entity.$SelectedWing and 
								@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
								<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
							</do_if>
							<do_else>
								<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
							</do_else>
													
							<do_for_each name="$ship" in="$orderships">
								<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
								<do_if value="$ship">
									<create_order name="$order" object="$ship" id="'AttackInRange'">
										<param name="destination" value="$destfinal" />
										<param name="debugchance" value="alAWHK.$debugChance" />
									</create_order>
								</do_if>
							</do_for_each>
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>								
				<cue name="InteractMenu_OnDockWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$doaction" exact="true" />
						
						<do_if value="event.param.$id == 'hk_dock_whk'">
							<set_value name="$destfinal" exact="player.target" />
							
							<set_value name="$validselection" exact="((@player.entity.$SelectedFleetCommander and @player.entity.$SelectedFleetCommander != player.occupiedship) or (@player.entity.$SelectedWing and @player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}))" />

							<do_if value="@$destfinal and @$destfinal.dockingallowed.{@player.entity.$SelectedFleetCommander} and $validselection">
								<speak actor="player.computer" page="10002" line="132" /> <!--"Command Accepted"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 451} + ' ' + {10002, 132}"/> <!--"Flt: Dock and Wait Command Accepted"-->
							</do_if>
							<do_else>
								<speak actor="player.computer" page="10002" line="133" /> <!--"Command Rejected"-->
								<show_notification text="player.entity.$SelectedFleet + '-' + player.entity.$SelectedWing + ': ' + {1041, 451} + ' ' + {10002, 133}"/> <!--"Flt: Dock and Wait Command Rejected"-->
								<set_value name="$doaction" exact="false" />		
							</do_else>
						</do_if>
						<do_else>
							<set_value name="$destfinal" exact="event.param.$object" />
						</do_else>
						
						<do_if value="$doaction">
							<do_if value="@player.entity.$SelectedWing and 
								@player.entity.$SelectedFleetCommander.activesubordinategroupids.indexof.{@player.entity.$SelectedWingID}">						
								<set_value name="$orderships" exact="@player.entity.$SelectedFleetCommander.subordinatesingroup.{@player.entity.$SelectedWingID}" />
							</do_if>
							<do_else>
								<set_value name="$orderships" exact="[@player.entity.$SelectedFleetCommander]" />
							</do_else>
													
							<do_for_each name="$ship" in="@$orderships">						
								<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
								<do_if value="$ship">							
									<create_order name="$order" object="$ship" id="'DockAndWait'">
										<param name="destination" value="$destfinal" />
										<param name="debugchance" value="alAWHK.$debugChance" />
									</create_order>
								</do_if>
							</do_for_each>
						</do_if>
						<reset_cue cue="this" />
					</actions>
				</cue>								
				<cue name="OnModInstallComplete">
					<actions>
						<set_value name="$debugChance" exact="0" />
						<debug_text text="'$debugChance: ' + $debugChance" />
					</actions>
				</cue>
			</cues>
		</cue>
	</cues>
</mdscript>