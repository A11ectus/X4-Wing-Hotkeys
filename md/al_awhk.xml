<?xml version="1.0" encoding="utf-8"?>
<mdscript name="al_wing_hotkeys" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<cue name="alAWHK" namespace="this">
			<conditions>
				<check_any>
					<event_cue_signalled cue="md.Setup.GameStart" />
					<event_game_loaded />
				</check_any>
			</conditions>
			<actions>
				<debug_text text="'event.name: ' + event.name" />
				<set_value name="$debugChance" exact="100" />
			</actions>
			<cues>
				<cue name="Init">
					<conditions>
						<check_any>
							<event_cue_signalled />
							<event_game_loaded />
						</check_any>
					</conditions>
					<actions>
						<debug_text text="'$debugChance: ' + $debugChance" />

						<reset_cue cue="this" />
					</actions>
				</cue>
				<cue name="OnModInstall">
					<actions>
						<debug_text text="'$debugChance: ' + $debugChance" />
						<signal_cue cue="Init" />
					</actions>
				</cue>
				<cue name="InteractMenu_AddWingOrders" instantiate="true">
					<conditions>
						<event_cue_signalled cue="md.Interact_Menu_API.Get_Actions" />
					</conditions>
					<actions>
						<set_value name="$ship" exact="@event.param.$selectedplayerships.{1}" />
						<set_value name="$target" exact="@event.param.$object" />
						<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
						
						<!--Wing Selection-->
						
						<do_if value="not $ship">
							<set_value name="$section" exact="'main'" />						
						
							<do_if value="player.entity.$SelectedWing">
								<set_value name="$text" exact="{23811, 1000} + player.entity.$SelectedWing" comment="Clear Wing Slection: " />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_clear_m',
										$section = $section,
										$text = $text,
										$icon = 'order_recycle',
										$callback = InteractMenu_OnSelectWing,
										$echo='Clear'
									]" />							
							</do_if>

							<do_if value="@player.entity.$SelectedWing != 'Alpha' and @player.occupiedship.activesubordinategroupids.indexof.{1}">
								<set_value name="$text" exact="{23811, 1001}" comment="Select Alpha Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_alpha_m',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Alpha'
									]" />
							</do_if>
								
							<do_if value="@player.entity.$SelectedWing != 'Beta' and @player.occupiedship.activesubordinategroupids.indexof.{2}">
								<set_value name="$text" exact="{23811, 1002}" comment="Select Beta Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_beta_m',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Beta'
									]" />
							</do_if>
								
							<do_if value="@player.entity.$SelectedWing != 'Gamma' and @player.occupiedship.activesubordinategroupids.indexof.{3}">
								<set_value name="$text" exact="{23811, 1003}" comment="Select Gamma Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_gamma_m',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Gamma'
									]" />								
							</do_if>
								
							<do_if value="@player.entity.$SelectedWing != 'Delta' and @player.occupiedship.activesubordinategroupids.indexof.{4}">
								<set_value name="$text" exact="{23811, 1004}" comment="Select Delta Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_delta_m',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Delta'
									]" />	
							</do_if>
							
							<!--Base Orders-->							
							<do_if value="$target and player.entity.$SelectedWing and 
							@player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2000}" comment="Wing: Remove All Orders" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_remove_all_orders_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_waitforsignal',
									$callback = InteractMenu_OnRemoveOrdersWHK,
									$echo='Wing: All'
								]" />

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2001}" comment="Wing: Remove First Order" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'remove_first_order_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_waitforsignal',
									$callback = InteractMenu_OnRemoveOrdersWHK,
									$echo='Wing: First'
								]" />

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2002}" comment="Wing: Remove Last Order" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'remove_last_order_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_waitforsignal',
									$callback = InteractMenu_OnRemoveOrdersWHK,
									$echo='Wing: Last'
								]" />

								
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2003}" comment="Wing: Fly and Wait" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = InteractMenu_OnMoveWHK,
									$echo='Wing: Move'
								]" />
							</do_if>
							
							<do_if value="@$target.dockingallowed.{@player.occupiedship} and @player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">	
							<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2004}" comment="Wing: Dock and Wait" />
							<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
								$id = 'order_dock_whk',
								$section = $section,
								$text = $text,
								$icon = 'order_dockandwait',
								$callback = InteractMenu_OnDockWHK,
								$echo='Wing: Dock'
							]" />
							</do_if>	
							
							<do_if value="($target.isclass.ship or $target.isclass.spacesuit) and player.entity.$SelectedWing and 
							@player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2005}" comment="Wing: Follow until further notice" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_follow_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_follow',
										$callback = InteractMenu_OnMoveWHK,
										$echo='Wing: Follow'
									]" />
							</do_if>
							
							<do_if value="($target.isclass.destructible) and (not ($target.owner == faction.player))  and @player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">	
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2006}" comment="Wing: Attack" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_attack_whk',
									$section = $section,
									$text = $text,
									$icon = 'order_attack',
									$callback = InteractMenu_OnAttackWHK,
									$echo='Wing: Attack'
								]" />
							</do_if>	

							<do_if value="$target and player.entity.$SelectedWing and 
							@player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 2007}" comment="Wing: Attack targets in range" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_attackinrange_whk',
										$section = $section,
										$text = $text,
										$icon = 'order_attackinrange',
										$callback = InteractMenu_OnAttackWHK,
										$echo='Wing: Attack in range'
									]" />
							</do_if>
							
							<!--Urgent Orders-->
							<do_if value="$target and player.entity.$SelectedWing and 
							@player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3001}" comment="Wing: Fly and Wait, Immediate" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_immediate',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Immediate'
								]" />

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3002}" comment="Wing: Fly and Wait, Immediate/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_immediatesameplane',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Immediate / Same Plane'
								]" />

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3003}" comment="Wing: Fly and Wait, Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_sameplane',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Same Plane'
								]" />
								
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3004}" comment="Wing: Fly and Wait, No Recall" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_norecall',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: No Recall'
								]" />

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3005}" comment="Wing: Fly and Wait, No Recall/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_norecallsameplane',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: No Recall / Same Plane'
								]" />							

								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3006}" comment="Wing: Fly and Wait, Urgent" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_urgent',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Urgent'
								]" />															
								
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3007}" comment="Wing: Fly and Wait, Urgent/Same Plane" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_move_urgentsameplane',
									$section = $section,
									$text = $text,
									$icon = 'order_movewait',
									$callback = md.al_urgent_orders.InteractMenu_OnMoveUrgent,
									$echo='Wing: Urgent / Same Plane'
								]" />										
							</do_if>
							
							<do_if value="@$target.dockingallowed.{@player.occupiedship} and @player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">	
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3008}" comment="Dock and Wait, Urgent" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_dock_urgent',
									$section = $section,
									$text = $text,
									$icon = 'order_dockandwait',
									$callback = md.al_urgent_orders.InteractMenu_OnDockUrgent,
									$echo='Wing: Urgent'
								]" />
							</do_if>
							
							<do_if value="($target.isclass.destructible) and (not ($target.owner == faction.player))  and @player.occupiedship.activesubordinategroupids.indexof.{player.entity.$SelectedWingID}">	
								<set_value name="$text" exact="player.entity.$SelectedWing + ' ' + {23811, 3000}" comment="Attack, Immediate" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_attack_immediate',
									$section = $section,
									$text = $text,
									$icon = 'order_attack',
									$callback = md.al_urgent_orders.InteractMenu_OnAttackUrgent,
									$echo='Wing: Immediate'
								]" />
							</do_if>	
							
						</do_if>
						
						<!--Wing Selection-->
						
						<do_if value="$ship and $ship.owner == faction.player">
														
							<set_value name="$section" exact="'player_interaction'" />						
							
							<do_if value="player.entity.$SelectedWing">
								<set_value name="$text" exact="{23811, 1000} + player.entity.$SelectedWing" comment="Clear Wing Slection: " />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_clear_pi',
										$section = $section,
										$text = $text,
										$icon = 'order_recycle',
										$callback = InteractMenu_OnSelectWing,
										$echo='Clear'
									]" />							
							</do_if>
							
							<do_if value="@player.entity.$SelectedWing != 'Alpha' and @player.occupiedship.activesubordinategroupids.indexof.{1}">							
							<set_value name="$text" exact="{23811, 1001}" comment="Select Alpha Wing" />
								<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
									$id = 'order_select_alpha_pi',
									$section = $section,
									$text = $text,
									$icon = 'order_assigncommander',
									$callback = InteractMenu_OnSelectWing,
									$echo='Alpha'
								]" />
							</do_if>

							<do_if value="@player.entity.$SelectedWing != 'Beta' and @player.occupiedship.activesubordinategroupids.indexof.{2}">
								<set_value name="$text" exact="{23811, 1002}" comment="Select Beta Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_beta_pi',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Beta'
									]" />								
							</do_if>
								
							<do_if value="@player.entity.$SelectedWing != 'Gamma' and @player.occupiedship.activesubordinategroupids.indexof.{3}">
								<set_value name="$text" exact="{23811, 1003}" comment="Select Gamma Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_gamma_pi',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Gamma'
									]" />								
							</do_if>
								
							<do_if value="@player.entity.$SelectedWing != 'Delta' and @player.occupiedship.activesubordinategroupids.indexof.{4}">
								<set_value name="$text" exact="{23811, 1004}" comment="Select Delta Wing" />
									<signal_cue_instantly cue="md.Interact_Menu_API.Add_Action" param = "table[
										$id = 'order_select_delta_pi',
										$section = $section,
										$text = $text,
										$icon = 'order_assigncommander',
										$callback = InteractMenu_OnSelectWing,
										$echo='Delta'
									]" />																		
							</do_if>
																		
						</do_if>
						<cancel_cue cue="this" />
					</actions>
				</cue>
				<cue name="InteractMenu_OnSelectWing">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="player.entity.$SelectedWing" exact="event.param.$echo"/>
						
						<do_if value="player.entity.$SelectedWing == 'Alpha'">
							<set_value name="player.entity.$SelectedWingID" exact="1"/>
						</do_if>
						<do_elseif value="player.entity.$SelectedWing == 'Beta'">
							<set_value name="player.entity.$SelectedWingID" exact="2"/>
						</do_elseif>
						<do_elseif value="player.entity.$SelectedWing == 'Gamma'">
							<set_value name="player.entity.$SelectedWingID" exact="3"/>
						</do_elseif>
						<do_elseif value="player.entity.$SelectedWing == 'Delta'">
							<set_value name="player.entity.$SelectedWingID" exact="4"/>
						</do_elseif>
						<do_else> <!--Implicitly captures 'clear' command as well-->
							<set_value name="player.entity.$SelectedWing" exact="null"/>
							<set_value name="player.entity.$SelectedWingID" exact="null"/>
						</do_else>

						<debug_text text="'Wing Selected: ' + player.entity.$SelectedWing" chance="100" />						
						<debug_text text="'Wing ID: ' + player.entity.$SelectedWingID" chance="100" />
						<debug_text text="'Available Wings: ' + player.occupiedship.activesubordinategroupids" chance="100" />
						
						<reset_cue cue="this" />
					</actions>
				</cue>					
				<cue name="InteractMenu_OnAttackWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$target" exact="event.param.$object" />
						<set_value name="$attackcat" exact="event.param.$echo" />
						
						<set_value name="$orderships" exact="@player.occupiedship.subordinatesingroup.{player.entity.$SelectedWingID}" />
						
						<do_for_each name="$ship" in="@$orderships">						
							<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
							<do_if value="$ship">
								<create_order name="$order" object="$ship" id="'Attack'">
									<param name="primarytarget" value="$target" />
									<param name="debugchance" value="alAWHK.$debugChance" />
								</create_order>
							</do_if>
						</do_for_each>
						<reset_cue cue="this" />
					</actions>
				</cue>	
				<cue name="InteractMenu_OnRemoveOrdersWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$destobject" exact="event.param.$object" />
						<set_value name="$destoffset" exact="event.param.$offset" />
						<set_value name="$destoffsetcomponent" exact="event.param.$offsetcomponent" />
						<set_value name="$destfinal" exact="[$destoffsetcomponent, $destoffset]" />
						<set_value name="$movecat" exact="event.param.$echo" />
							
						<set_value name="$orderships" exact="@player.occupiedship.subordinatesingroup.{player.entity.$SelectedWingID}" />
												
						<do_for_each name="$ship" in="$orderships">
							<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
							<do_if value="$ship">
								<create_order name="$order" object="$ship" id="'MoveWait'">
									<param name="destination" value="$destfinal" />
									<param name="debugchance" value="alAWHK.$debugChance" />
								</create_order>
							</do_if>
						</do_for_each>
						<reset_cue cue="this" />
					</actions>
				</cue>								
				<cue name="InteractMenu_OnMoveWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$destobject" exact="event.param.$object" />
						<set_value name="$destoffset" exact="event.param.$offset" />
						<set_value name="$destoffsetcomponent" exact="event.param.$offsetcomponent" />
						<set_value name="$destfinal" exact="[$destoffsetcomponent, $destoffset]" />
						<set_value name="$movecat" exact="event.param.$echo" />
							
						<set_value name="$orderships" exact="@player.occupiedship.subordinatesingroup.{player.entity.$SelectedWingID}" />
												
						<do_for_each name="$ship" in="$orderships">
							<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
							<do_if value="$ship">
								<create_order name="$order" object="$ship" id="'MoveWait'">
									<param name="destination" value="$destfinal" />
									<param name="debugchance" value="alAWHK.$debugChance" />
								</create_order>
							</do_if>
						</do_for_each>
						<reset_cue cue="this" />
					</actions>
				</cue>				
				<cue name="InteractMenu_OnDockWHK">
					<conditions>
						<event_cue_signalled />
					</conditions>
					<actions>
						<set_value name="$destfinal" exact="event.param.$object" />
						<set_value name="$dockcat" exact="event.param.$echo" />

						<set_value name="$orderships" exact="@player.occupiedship.subordinatesingroup.{player.entity.$SelectedWingID}" />
												
						<do_for_each name="$ship" in="@$orderships">						
							<debug_text text="'$ship: ' + $ship + ' (' + @$ship.knownname + ')'" chance="alAWHK.$debugChance" />
							<do_if value="$ship">							
								<create_order name="$order" object="$ship" id="'DockAndWait'">
									<param name="destination" value="$destfinal" />
									<param name="debugchance" value="alAWHK.$debugChance" />
								</create_order>
							</do_if>
						</do_for_each>
						<reset_cue cue="this" />
					</actions>
				</cue>								
				<cue name="OnModInstallComplete">
					<actions>
						<set_value name="$debugChance" exact="0" />
						<debug_text text="'$debugChance: ' + $debugChance" />
					</actions>
				</cue>
			</cues>
		</cue>
	</cues>
</mdscript>